"use strict";BX.namespace("BX.Rest.Marketplace.Install");BX.Rest.Marketplace.Install={init:function(t){t=typeof t==="object"?t:{};this.code=t.CODE||false;this.version=t.VERSION||false;this.checkHash=t.CHECK_HASH||false;this.installHash=t.INSTALL_HASH||false;this.from=t.FROM||false;this.iframe=t.IFRAME||false;this.redirectPriority=t.REDIRECT_PRIORITY||false;this.formNode=BX("rest_mp_install_form");this.buttonInstallNode=BX.findChildByClassName(this.formNode,"rest-btn-start-install");this.buttonCloseNode=BX.findChildByClassName(this.formNode,"rest-btn-close-install");BX.bind(this.formNode,"submit",this.onSubmitForm.bind(this));BX.bind(this.buttonCloseNode,"click",this.onClickClose.bind(this))},onClickClose:function(t){t.preventDefault();if(!!this.iframe){BX.SidePanel.Instance.close()}},onSubmitForm:function(t){t.preventDefault();if(BX("mp_tos_license")&&!BX("mp_tos_license").checked){BX("rest_mp_install_detail_error").innerHTML=BX.message("REST_MARKETPLACE_INSTALL_TOS_ERROR");return}if(BX("mp_detail_license")&&!BX("mp_detail_license").checked||BX("mp_detail_confidentiality")&&!BX("mp_detail_confidentiality").checked){BX("rest_mp_install_detail_error").innerHTML=BX.message("REST_MARKETPLACE_INSTALL_LICENSE_ERROR");return}if(BX.hasClass(this.buttonInstallNode,"popup-window-button-wait")){return}BX.addClass(this.buttonInstallNode,"popup-window-button-wait");var e={code:this.code};if(!!this.version){e.version=this.version}if(!!this.checkHash){e.check_hash=this.checkHash;e.install_hash=this.installHash}if(!!this.from){e.from=this.from}BX.ajax.runAction("rest.application.install",{data:e}).then(function(t){var e=!!t.data?t.data:t;if(!!e.error){BX("rest_mp_install_error").innerHTML=e.error+(!!e.error_description?"<br />"+e.error_description:"");BX.show(BX("rest_mp_install_error"))}else if(!!e.redirect&&this.redirectPriority===true){top.location.href=e.redirect}else if(!this.iframe){if(!!e.redirect){top.location.href=e.redirect}else{top.location.href=BX.util.remove_url_param(top.location.href,["install"])}}else{if(e.installed){var i={};top.BX.onCustomEvent(top,"Rest:AppLayout:ApplicationInstall",[true,i],false)}if(!!e.open){BX.SidePanel.Instance.reload();top.BX.rest.AppLayout.openApplication(e.id,{})}else{BX.SidePanel.Instance.reload()}}}.bind(this))}};
//# sourceMappingURL=script.map.js